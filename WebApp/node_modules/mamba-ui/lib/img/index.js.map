{"version":3,"sources":["img/index.jsx"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","defaultEmptyImageSrc","defaultErrorImageSrc","defaultEmptyText","defaultErrorText","setImageConfig","options","emptyImageSrc","errorImageSrc","emptyText","errorText","undefined","Img","props","state","src","showErrorImage","showErrorTips","viewerVisible","hasClickEvent","hasErrorImageEorror","that","errorImg","Image","onload","hasThumb","thumb","onError","bind","renderImgNode","onImgClick","renderImageViewer","onViewerClose","prevProps","prevSrc","setState","onClick","allowView","viewer","title","alt","photo","newPhoto","id","name","_a","prefixCls","className","style","rest","restClone","imgProps","assign","node","backgroundColor","isAllow","thumbCls","cls","React","Component","defaultProps","config"],"mappings":"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","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as React from 'react';\nimport classnames from 'classnames';\nimport isEqual from 'lodash/isEqual';\nimport isFunction from 'lodash/isFunction';\nimport cloneDeep from 'lodash/cloneDeep';\nimport getComponentProps from '../_utils/getComponentProps';\nimport ImgViewer from '../img-viewer';\nlet defaultEmptyImageSrc = '';\nlet defaultErrorImageSrc = '';\nlet defaultEmptyText = '暂无封面';\nlet defaultErrorText = '图片出错';\nfunction setImageConfig(options) {\n    const { emptyImageSrc, errorImageSrc, emptyText, errorText } = options;\n    if (emptyImageSrc !== undefined) {\n        defaultEmptyImageSrc = emptyImageSrc;\n    }\n    if (errorImageSrc !== undefined) {\n        defaultErrorImageSrc = errorImageSrc;\n    }\n    if (emptyText !== undefined) {\n        defaultEmptyText = emptyText;\n    }\n    if (errorText !== undefined) {\n        defaultErrorText = errorText;\n    }\n}\nexport default class Img extends React.Component {\n    constructor(props) {\n        super(props);\n        this.emptyImageSrc =\n            props.emptyImageSrc === undefined ? defaultEmptyImageSrc : props.emptyImageSrc;\n        this.errorImageSrc =\n            props.errorImageSrc === undefined ? defaultErrorImageSrc : props.errorImageSrc;\n        this.state = {\n            src: props.src || this.emptyImageSrc,\n            showErrorImage: false,\n            showErrorTips: false,\n            viewerVisible: false,\n            hasClickEvent: !!props.src,\n        };\n        // errorImageSrc URL是否存在问题\n        this.hasErrorImageEorror = true;\n        if (!!this.errorImageSrc) {\n            const that = this;\n            let errorImg = new Image();\n            errorImg.src = this.errorImageSrc;\n            errorImg.onload = function () {\n                that.hasErrorImageEorror = false;\n                errorImg = null;\n            };\n        }\n        // 缩略图\n        this.hasThumb = !!props.thumb;\n        this.onError = this.onError.bind(this);\n        this.renderImgNode = this.renderImgNode.bind(this);\n        this.onImgClick = this.onImgClick.bind(this);\n        this.renderImageViewer = this.renderImageViewer.bind(this);\n        this.onViewerClose = this.onViewerClose.bind(this);\n    }\n    componentDidUpdate(prevProps) {\n        const src = this.props.src;\n        const prevSrc = prevProps.src;\n        if (!isEqual(src, prevSrc)) {\n            this.setState({\n                src: src || this.emptyImageSrc,\n                hasClickEvent: !!src,\n                showErrorImage: false,\n                showErrorTips: false,\n            });\n        }\n    }\n    // 图片出错\n    onError() {\n        // 取消点击事件\n        this.setState({\n            hasClickEvent: false,\n        });\n        const errorImageSrc = this.errorImageSrc;\n        // 若已显示图片出错图像的URL，此URL亦存在问题，则跳过显示默认样式\n        if (!!errorImageSrc && !this.hasErrorImageEorror) {\n            // errorImageSrc 不为空，则替换 src 为 errorImageSrc\n            this.setState({\n                src: errorImageSrc,\n                showErrorImage: true,\n            });\n        }\n        else {\n            // 显示默认样式\n            this.setState({\n                showErrorTips: true,\n            });\n        }\n    }\n    // 图片点击\n    onImgClick() {\n        this.setState({\n            viewerVisible: true,\n        });\n        // 回调\n        if (isFunction(this.props.onClick)) {\n            this.props.onClick();\n        }\n    }\n    // 关闭画廊\n    onViewerClose() {\n        this.setState({\n            viewerVisible: false,\n        });\n    }\n    // 查看\n    renderImageViewer({ allowView, viewer, }) {\n        if (!allowView) {\n            return null;\n        }\n        const { src, title = '', alt = '' } = this.props;\n        const { photo } = getComponentProps(viewer);\n        let newPhoto = photo;\n        // 若未配置photo，则默认使用Iamge src展示\n        if (!photo) {\n            newPhoto = { id: src, name: title || alt };\n        }\n        return (<ImgViewer photo={newPhoto} {...viewer} visible={this.state.viewerVisible} onClose={this.onViewerClose}/>);\n    }\n    renderImgNode() {\n        const { src, showErrorImage, showErrorTips, hasClickEvent } = this.state;\n        const _a = this.props, { prefixCls, className, style, thumb, emptyText = defaultEmptyText, errorText = defaultErrorText, onClick } = _a, rest = __rest(_a, [\"prefixCls\", \"className\", \"style\", \"thumb\", \"emptyText\", \"errorText\", \"onClick\"]);\n        let restClone = cloneDeep(rest);\n        delete restClone.src;\n        delete restClone.errorImageSrc;\n        delete restClone.emptyImageSrc;\n        let imgProps = Object.assign({ src,\n            className,\n            style,\n            onClick, onError: this.onError }, restClone);\n        showErrorImage && (imgProps = Object.assign(Object.assign({}, imgProps), { 'data-error': rest.src }));\n        // 默认展示\n        let node = <img {...imgProps}/>;\n        // 缩略图模式 | 此模式下支持放大查看\n        if (this.hasThumb) {\n            const { backgroundColor, // 背景色\n            allowView = false, // 是否允许点击\n            viewer, } = getComponentProps(thumb);\n            // 行内样式\n            let style;\n            if (backgroundColor) {\n                style = { backgroundColor };\n            }\n            // class\n            const isAllow = allowView && hasClickEvent;\n            const thumbCls = classnames(`${prefixCls}-thumb`, {\n                [`${prefixCls}-view`]: isAllow,\n            });\n            // 允许查看\n            if (isAllow) {\n                imgProps = Object.assign(Object.assign({}, imgProps), { onClick: this.onImgClick });\n            }\n            node = (<div className={thumbCls} style={style}>\n                    <img {...imgProps}/>\n                    {this.renderImageViewer({ allowView: isAllow, viewer })}\n                </div>);\n        }\n        if (!src || showErrorTips) {\n            const cls = classnames(className, {\n                [`${prefixCls}-nodata`]: !src,\n                [`${prefixCls}-error`]: showErrorTips,\n            });\n            // src|emptyImageSrc 都为空，提供默认样式\n            if (!src) {\n                node = (<div className={cls} style={style}>\n                        <p>{emptyText}</p>\n                    </div>);\n            }\n            // src资源出错，errorImageSrc为空，提供默认样式\n            if (showErrorTips) {\n                node = (<div className={cls} style={style} data-error={src}>\n                        <p>{errorText}</p>\n                        <img src={src} className={`${prefixCls}-error-img-hid`}/>\n                    </div>);\n            }\n        }\n        return node;\n    }\n    render() {\n        return this.renderImgNode();\n    }\n}\nImg.defaultProps = {\n    prefixCls: 'ember-image',\n    thumb: false,\n};\nImg.config = setImageConfig;\n"],"file":"index.js"}