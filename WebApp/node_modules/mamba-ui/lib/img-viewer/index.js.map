{"version":3,"sources":["img-viewer/index.jsx"],"names":["Mode","checkMode","x","mode","VIEWER","len","length","GALLERY","ImgViewerPropTypes","index","PropTypes","number","options","object","photo","oneOfType","array","visible","bool","ImgViewer","arguments","Object","assign","button","navbar","title","toolbar","tooltip","movable","zoomable","rotatable","scalable","transition","props","thatProps","container","document","createElement","viewer","Viewer","hidden","onClose","view","e","onIndexChange","detail","nextProps","childNodes","innerHTML","newPhoto","imgElem","src","id","alt","name","append","ulElem","map","item","liElem","update","destroy","React","Component","propTypes"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as PropTypes from 'prop-types';\nimport Viewer from 'viewerjs';\nimport cloneDeep from 'lodash/cloneDeep';\nimport isArray from 'lodash/isArray';\nimport isEmpty from 'lodash/isEmpty';\nimport isEqual from 'lodash/isEqual';\nimport isFunction from 'lodash/isFunction';\nimport isObject from '../_utils/isObject';\nexport var Mode;\n(function (Mode) {\n    Mode[\"VIEWER\"] = \"viewer\";\n    Mode[\"GALLERY\"] = \"gallery\";\n})(Mode || (Mode = {}));\nfunction checkMode(x) {\n    let mode = '';\n    if (isObject(x) && !isEmpty(x)) {\n        mode = Mode.VIEWER;\n    }\n    if (isArray(x)) {\n        let len = x.length;\n        mode = len == 0 ? '' : len == 1 ? Mode.VIEWER : Mode.GALLERY;\n    }\n    return mode;\n}\n// 类型检测\nconst ImgViewerPropTypes = {\n    index: PropTypes.number,\n    options: PropTypes.object,\n    photo: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n    visible: PropTypes.bool,\n};\nexport default class ImgViewer extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.options = Object.assign({ button: true, navbar: false, title: true, toolbar: true, tooltip: true, movable: true, zoomable: true, rotatable: true, scalable: true, transition: true }, this.props.options);\n    }\n    componentDidMount() {\n        const thatProps = this.props;\n        this.container = document.createElement('div');\n        this.viewer = new Viewer(this.container, Object.assign({ \n            // 关闭后\n            hidden() {\n                if ('onClose' in thatProps && isFunction(thatProps.onClose)) {\n                    thatProps.onClose();\n                }\n            },\n            view(e) {\n                if ('onIndexChange' in thatProps && isFunction(thatProps.onIndexChange)) {\n                    // 图片下标变更\n                    thatProps.onIndexChange(e.detail.index);\n                }\n            } }, this.options));\n    }\n    componentWillUpdate(nextProps) {\n        // visible 为true时\n        if (nextProps.visible && !isEqual(this.props.visible, nextProps.visible)) {\n            this.view(nextProps);\n        }\n    }\n    view(props) {\n        const container = this.container;\n        // 若容器中已存在子元素，则清空\n        if (container.childNodes.length > 0) {\n            container.innerHTML = '';\n        }\n        let { photo, index = 0 } = props;\n        const mode = checkMode(photo);\n        let newPhoto = cloneDeep(photo);\n        // 单张\n        if (mode === Mode.VIEWER) {\n            index = 0;\n            newPhoto = isObject(newPhoto) ? newPhoto : newPhoto[0];\n            const imgElem = document.createElement('img');\n            imgElem.src = newPhoto.id;\n            imgElem.alt = newPhoto.name;\n            container.append(imgElem);\n        }\n        // 多张\n        if (mode === Mode.GALLERY) {\n            let len = newPhoto.length - 1;\n            index = index < 0 ? 0 : index;\n            index = index > len ? len : index;\n            const ulElem = document.createElement('ul');\n            newPhoto.map(item => {\n                const liElem = document.createElement('li');\n                const imgElem = document.createElement('img');\n                imgElem.src = item.id;\n                imgElem.alt = item.name;\n                liElem.append(imgElem);\n                ulElem.append(liElem);\n            });\n            container.append(ulElem);\n        }\n        this.viewer.update();\n        this.viewer.view(index);\n    }\n    render() {\n        return null;\n    }\n    componentWillUnmount() {\n        // 销毁\n        this.viewer && this.viewer.destroy();\n    }\n}\nImgViewer.propTypes = ImgViewerPropTypes;\n"],"file":"index.js"}